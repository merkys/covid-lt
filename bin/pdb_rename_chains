#!/usr/bin/env python3

# Take two PDB files (source and target) and rename the chains in target.

import sys

source, target = sys.argv[1:3]

source_chains = []
for line in open(source, 'r'):
    if line[0:6] != 'ATOM  ':
        continue
    chain = line[21]
    if chain not in source_chains:
        source_chains.append(chain)

target_chains = []
for line in open(target, 'r'):
    if line[0:6] != 'ATOM  ':
        continue
    chain = line[21]
    if chain not in target_chains:
        target_chains.append(chain)

if len(source_chains) != len(target_chains):
    raise Exception('Chain lists are different in size: ' + str(source_chains) + ' and ' + str(target_chains))

mapping = dict(zip(target_chains, source_chains))

renamings = {
    'ATOM  ': [ 21 ],
    'CIPSEP': [ 15, 29 ],
    'HELIX ': [ 19, 31 ],
    'LINK  ': [ 21, 51 ],
    'SHEET ': [ 21, 32, 49, 64 ],
    'SITE  ': [ 22, 33, 44, 55 ],
    'SSBOND': [ 15, 29 ],
}

for line in open(target, 'r'):
    if line[0:6] in renamings:
        for renaming in renamings[line[0:6]]:
            line = line[0:renaming] + mapping[line[renaming]] + line[renaming+1:]
    print(line, end='')
