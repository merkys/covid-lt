#!/usr/bin/env python3

# Select chain(s) from a PDB file.

chain_identifiers = {
    'ATOM  ': [ 21 ],
    'CIPSEP': [ 15, 29 ],
    'DBREF ': [ 12 ],
    'DBREF1': [ 12 ],
    'DBREF2': [ 12 ],
    'HELIX ': [ 19, 31 ],
    'LINK  ': [ 21, 51 ],
    'SHEET ': [ 21, 32, 49, 64 ],
    'SITE  ': [ 22, 33, 44, 55 ],
    'SEQRES': [ 11 ],
    'SSBOND': [ 15, 29 ],
}

import argparse, sys

parser = argparse.ArgumentParser()
parser.add_argument('files', nargs='*')
parser.add_argument('--chain', action='append', help='Select certain chain(s), may be multiple')
args = parser.parse_args()

files = args.files
if len(files) == 0:
    files = [sys.stdin]

for file in files:
    if isinstance(file, str):
        file = open(file, 'r')
    for line in file:
        keyword = line[0:6]
        if keyword not in chain_identifiers or not args.chain:
            print(line, end='')
            continue
        mentioned_chains = set([line[x] for x in chain_identifiers[keyword]])
        if set(args.chain).isdisjoint(mentioned_chains):
            continue
        print(line, end='')
