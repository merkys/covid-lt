#!/usr/bin/Rscript --vanilla

library( 'optparse' )
library( 'randomForest' )

parser <- OptionParser()
parser <- add_option(parser, c( '--train-size' ), type = 'double', default = 0.8)
options = parse_args(parser, positional_arguments = TRUE)

D = read.csv( options$args[1], quote="", sep="\t" )

train_size = options$options$train
if( train_size < 1 ) {
    train_size = round( length(D[,1]) * train_size )
}

is_train = logical( length(D[,1]) )
is_train[1:train_size] = TRUE
is_train = sample( is_train )

train = D[ is_train, 2:length(D)]
test  = D[!is_train, 2:length(D)]

names(train) = names(D)[2:length(D)]
names(test)  = names(D)[2:length(D)]

model = randomForest( formula = ddG ~ ., data = train )
print(model)

P = predict(model, newdata=test)
cat("RMSE", sqrt(mean((P - test$ddG)**2)), "\n")
