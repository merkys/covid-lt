#!/usr/bin/Rscript --vanilla

library( 'optparse' )
library( 'randomForest' )

parser <- OptionParser()
options = parse_args(parser, positional_arguments = TRUE)

D = read.csv( options$args[1], quote="", sep="\t" )
is_train = sample( c(TRUE, FALSE), length(D[,1]), replace=TRUE, prob=c(0.4, 0.6) )

train = D[ is_train, 2:length(D)]
test  = D[!is_train, 2:length(D)]

names(train) = names(D)[2:length(D)]
names(test)  = names(D)[2:length(D)]

model = randomForest( formula = ddG ~ ., data = train )
print(model)

P = predict(model, newdata=test)
cat("RMSE", sqrt(mean((P - test$ddG)**2)), "\n")
