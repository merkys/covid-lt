#!/usr/bin/env python3

# Visualize contacts between protein chains by reading TAB file.

from networkx import Graph, draw, nx_agraph
from networkx.drawing.nx_pydot import write_dot
import sys

graph = Graph()

for filename in sys.argv[1:]:
    counts = {}
    for line in open(filename, 'r'):
        atom1, atom2 = {}, {}
        fields = line.strip().split('\t')
        atom1['chain'], atom1['res_nr'], atom1['res_type'], atom1['atom_nr'], atom1['atom_type'], \
            atom2['chain'], atom2['res_nr'], atom2['res_type'], atom2['atom_nr'], atom2['atom_type'], *fields = fields
        if atom1['chain'] == atom2['chain']:
            continue
        chains = ''.join(sorted([atom1['chain'], atom2['chain']]))
        if chains not in counts:
            counts[chains] = 0
        counts[chains] += 1
    graph = Graph()
    for edge in counts:
        graph.add_edge(edge[0], edge[1], label=counts[edge])
    draw(graph, pos=nx_agraph.graphviz_layout(graph))
    write_dot(graph, '/dev/stdout')
