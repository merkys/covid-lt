#!/bin/bash

MUT=$1

PARTNER1=$2
PARTNER2=$3

CHAINS=$(echo ${PARTNER1}${PARTNER2} | grep -o . | sort | xargs | sed 's/ //g')

PDB_FILE=$(mktemp)
PQR_FILE=$(mktemp)

(
    for FILE in ${MUT}_${CHAINS}.pdb ${MUT}_${CHAINS}_wt.pdb
    do
        bin/pdb_renumber ${FILE} \
            | bin/pdb_charmm_energy /dev/stdin --topology forcefields/top_all36_prot.rtf --parameters forcefields/par_all36m_prot.prm --pbeq \
            | grep '^ Parameter: TOTAL' \
            | cut -d '"' -f 2
    done

    for PARTNER in $PARTNER1 $PARTNER2
    do
        for FILE in ${MUT}_${CHAINS}_wt.pdb ${MUT}_${CHAINS}.pdb
        do
            bin/pdb_select --chain ${PARTNER} ${FILE} \
                | bin/pdb_renumber \
                | bin/pdb_charmm_energy /dev/stdin --topology forcefields/top_all36_prot.rtf --parameters forcefields/par_all36m_prot.prm --pbeq \
                | grep '^ Parameter: TOTAL' \
                | cut -d '"' -f 2
        done
    done

) | perl -le 'while (<>) {print $_ * (-1) ** ($. + 1)}'

rm -f ${PDB_FILE} ${PQR_FILE}
