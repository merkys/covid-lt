#!/bin/bash

PDB_ID=$1

# Taking only the first of S1 chains
S1_CHAIN=$(bin/pdb_compounds pdb/pristine/${PDB_ID}.pdb --hmmsearch pdb_seqres-PF09408.hmmsearch | head -n1 | cut -f 2)

# TODO: Check if any chains found
# TODO: What to do with multiple distances of the same residue?

# Assuming S1 is 1500 aminoacids long
bin/vorocontacts-select --chain ${S1_CHAIN} --exclude-self --dist min vorocontacts/${PDB_ID}.tab \
    | while read C1 R1 C2 R2 DIST
      do
        if [ "${C1}" = "${S1_CHAIN}" ]
        then
            echo -e "${R1}\t${DIST}"
        else
            echo -e "${R2}\t${DIST}"
        fi
      done \
    | sort -nk1.1 \
    | join -1 1 -2 1 -a 2 -e '?' - <(seq 1 1500) --nocheck-order
